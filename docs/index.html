<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>EffekseerForWebGL</title>
    <link rel="stylesheet" type="text/css" href="style.css">
  <body>
    <div id="app"><canvas id="canvas" oncontextmenu="event.preventDefault()"></canvas></div>
    
    <div id="menu">
    <div class="mb-10" id="buttons">
	<a href="#" class="btn btn-mod btn-border btn-circle btn-medium" onclick="effekseer.play(effects['sword'], 0, 0, 0);">乱れ斬り</a>
	<a href="#" class="btn btn-mod btn-border btn-circle btn-medium" onclick="effekseer.play(effects['TitleEffect'], 0, 0, 0);">LevelUp</a>
	<a href="#" class="btn btn-mod btn-border btn-circle btn-medium" onclick="effekseer.play(effects['Laser02'], 0, 0, 0);">レーザー</a>
	<a href="#" class="btn btn-mod btn-border btn-circle btn-medium" onclick="effekseer.play(effects['block'], 0, 0, 0);">ブロック</a>
	</div>
	<div class="mb-10" id="buttons2">
	<a href="#" class="btn btn-mod btn-border btn-circle btn-medium" onclick="stopAll();">停止</a>
	<a href="#" class="btn btn-mod btn-border btn-circle btn-medium" onclick="togglePause();" id="buttonPause">ポーズ</a>
	<a href="#" class="btn btn-mod btn-border btn-circle btn-medium" onclick="toggleRotate();" id="buttonRotate">自動回転OFF</a>
	<a href="#" class="btn btn-mod btn-border btn-circle btn-medium" onclick="capture();">画像キャプチャー</a>
	</div>
	</div>
    
    </div>
    <script type='text/javascript'>
      var effects = {};
      var main = function () {
        var _app = document.getElementById("app");
        var canvas = document.getElementById("canvas");
        var width  = canvas.width;
        var height = canvas.height;

        var scene = new THREE.Scene();

        var fov    = 30;
        var aspect = width / height;
        var near   = 1;
        var far    = 1000;
        var camera = new THREE.PerspectiveCamera( fov, aspect, near, far );
        var target = new THREE.Vector3(0, 0, 0);
        camera.position.set( 20, 20, 20 );
        camera.lookAt(target);
        
        controls = new THREE.OrbitControls(camera);
        controls.autoRotate = false;

        var renderer = new THREE.WebGLRenderer({canvas: canvas, preserveDrawingBuffer: true});
        renderer.setSize( width, height );
        //document.body.appendChild( renderer.domElement );

		effekseer.init(renderer.context);
		effects["sword"] = effekseer.loadEffect("Resource/002_sword_effect/sword.efk");
		effects["Laser02"] = effekseer.loadEffect("Resource_/Laser01.efk");
		effects["TitleEffect"] = effekseer.loadEffect("Resource/004_logo_effect/TitleEffect.efk");
		effects["distortion"] = effekseer.loadEffect("Resource/005_distortion_effect/distortion.efk");
		effects["block"] = effekseer.loadEffect("Resource_/block.efk");

        var grid = new THREE.GridHelper(20, 10, 0xffffff, 0xffffff);
        //scene.add(grid);

        var directionalLight = new THREE.DirectionalLight( 0xffffff );
        directionalLight.position.set( 0, 0.7, 0.7 );
        scene.add( directionalLight );

        var geometry = new THREE.CubeGeometry( 2, 2, 2 );
        var material = new THREE.MeshPhongMaterial( { color: 0xff0000 } );
        var mesh = new THREE.Mesh( geometry, material );
        //scene.add( mesh );
        
        ( function renderLoop () {
          requestAnimationFrame( renderLoop );
          
          if (!paused) {
          	effekseer.update();
          }          
          controls.update();
          
          renderer.render( scene, camera );
          effekseer.setProjectionMatrix(camera.projectionMatrix.elements);
          effekseer.setCameraMatrix(camera.matrixWorldInverse.elements);
          effekseer.draw();
        
        } )();
      };
      window.addEventListener( 'DOMContentLoaded', main, false );
      var paused = false;
      function stopAll() {
      	paused = false;
		effekseer.stopAll();
      }
      function togglePause () {
      	paused = !paused;
      	
      	document.getElementById("buttonPause").innerHTML = paused? "再生":"ポーズ";
      }
      function toggleRotate () {
        if (!controls) return;
      	controls.autoRotate = !controls.autoRotate;
      	
      	document.getElementById("buttonRotate").innerHTML = controls.autoRotate? "自動回転ON":"自動回転OFF";
      }
      function capture () {
        var canvas = window.document.getElementById("canvas");
      	var dataUrl = canvas.toDataURL();
      	
      	window.open(dataUrl);
      }
      
	var canvas = document.getElementById('canvas');
	var container = document.getElementById('app');
	sizing();
	function sizing() {
		canvas.height = container.offsetHeight;
		canvas.width = container.offsetWidth;
	}
    </script>
    <script src="js/three.min.js"></script>
    <script src="js/OrbitControls.js"></script>
    <script src="js/effekseer.min.js"></script>
  </body>
</html>
